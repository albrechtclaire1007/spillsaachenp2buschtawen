<!DOCTYPE html>
<html lang="lb">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Schreif d'Wuert – Spillsaachen</title>
  <style>
    @font-face {
      font-family: 'Schoulschreft';
      src: url('https://github.com/albrechtclaire1007/schoulschreft/raw/main/schoulschreft_bold%5B2%5D.TTF') format('truetype');
      font-weight: bold;
    }
    body{
      box-sizing:border-box;margin:0;padding:20px;
      font-family:'Schoulschreft',Arial,sans-serif;
      background:linear-gradient(135deg,#d8ebd4 0%,#8cc987 100%);
      min-height:100vh;display:flex;flex-direction:column;align-items:center;user-select:none;
    }
    .game-container{
      width:100%;max-width:900px;background:#fff;border-radius:20px;padding:30px;
      box-shadow:0 10px 30px rgba(0,0,0,.1);display:flex;flex-direction:column;align-items:center;gap:30px;min-height:70vh;position:relative;
    }
    .progress-bar{width:100%;height:8px;background:#f0f0f0;border-radius:4px;overflow:hidden}
    .progress-fill{height:100%;background:#8cc987;border-radius:4px;transition:width .3s ease}
    .word-counter{font-size:16px;color:#666}

    /* Image section with audio overlay */
    .image-section{
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .toy-image{
      width:200px;height:200px;object-fit:contain;background:#fff;border-radius:15px;
      box-shadow:0 5px 15px rgba(0,0,0,.1);
      display:block;
    }
    .audio-img{
      position:absolute;
      top:50%; left:50%;
      transform:translate(-50%,-50%);
      width:64px; height:64px;
      cursor:pointer;
      -webkit-user-drag:none;
      transition:transform .15s ease;
    }
    .audio-img:active{transform:translate(-50%,-50%) scale(0.95);}
    .audio-img[aria-disabled="true"]{opacity:.5;pointer-events:none}

    .answer-slots{display:flex;flex-wrap:wrap;justify-content:center;gap:8px;min-height:60px;align-items:center}
    .slot{
      width:50px;height:50px;border:3px dashed #ccc;border-radius:10px;display:flex;align-items:center;justify-content:center;
      font-size:24px;font-weight:bold;background:#f9f9f9;transition:all .2s ease;cursor:pointer
    }
    .slot.filled{border:3px solid #8cc987;background:#d8ebd4;color:#000}
    .slot.drag-over{border-color:#8cc987;background:#d8ebd4;transform:scale(1.05)}
    .slot.correct{border-color:#8cc987;background:#8cc987;color:#fff}
    .slot.incorrect{border-color:#ff6b6b;background:#ffe0e0;animation:shake .5s ease-in-out}
    @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
    .letter-bank{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;padding:20px;background:#f8f8f8;border-radius:15px;min-height:80px}
    .letter-tile{
      width:50px;height:50px;background:#fff;border:2px solid #ddd;border-radius:10px;display:flex;align-items:center;justify-content:center;
      font-size:24px;font-weight:bold;cursor:grab;transition:all .2s ease;box-shadow:0 2px 5px rgba(0,0,0,.1);user-select:none
    }
    .letter-tile:active{cursor:grabbing}
    .letter-tile.used{opacity:.3;pointer-events:none}
    .button-group{display:flex;gap:15px}
    .game-button{padding:12px 24px;border:none;border-radius:25px;font-size:16px;font-family:'Schoulschreft',Arial,sans-serif;cursor:pointer;transition:all .2s ease;font-weight:bold}
    .check-button{background:#8cc987;color:#fff}
    .check-button:hover{background:#7ab87a}
    .check-button:disabled{background:#ccc;cursor:not-allowed}
    .reset-button{background:#ff6b6b;color:#fff}
    .reset-button:hover{background:#ff5252}
    .next-button{background:#4CAF50;color:#fff}
    .next-button:hover{background:#45a049}
    .feedback{font-size:24px;font-weight:bold;min-height:30px;text-align:center}
    .success{color:#4CAF50;animation:bounce .6s ease-in-out}
    @keyframes bounce{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
    .final-screen{text-align:center;padding:40px 20px}
    .final-screen h1{color:#8cc987;font-size:32px;margin-bottom:20px}
    .final-score{font-size:24px;color:#666;margin-bottom:30px}

    @media (max-width:480px){
      .toy-image{width:150px;height:150px}
      .slot,.letter-tile{width:45px;height:45px;font-size:20px}
      .audio-img{width:56px;height:56px;}
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div style="width:100%">
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      <div class="word-counter" id="wordCounter">Wuert 1 vun 12</div>
    </div>

    <div class="image-section">
      <!-- toy image -->
      <img class="toy-image" id="toyImage" alt="Spillsaach">
      <!-- overlay audio icon -->
      <img id="audioImg" class="audio-img" 
           src="https://i.postimg.cc/kXzQdjQp/temp-Imagef0iu-HC.avif"
           alt="Toun nei ofspillen"
           role="button"
           tabindex="0">
    </div>

    <div class="answer-slots" id="answerSlots"></div>
    <div class="letter-bank" id="letterBank"></div>
    <div class="feedback" id="feedback"></div>

    <div class="button-group">
      <button class="game-button reset-button" id="resetButton">zrécksetzen</button>
      <button class="game-button check-button" id="checkButton">kontrolléieren</button>
      <button class="game-button next-button" id="nextButton" style="display:none">weider</button>
    </div>
  </div>

  <audio id="audio" preload="auto" playsinline></audio>

  <script>
    // --- AUDIO AUTOPLAY UNLOCK ---
    let audioReady = false;
    const audioEl = document.getElementById('audio');
    function unlockAudioOnce() {
      if (audioReady) return;
      audioEl.muted = true;
      audioEl.play().then(() => {
        audioEl.pause(); audioEl.currentTime = 0; audioEl.muted = false;
        audioReady = true;
      }).catch(()=>{}); 
    }
    document.addEventListener('pointerdown', unlockAudioOnce, { once:true });
    document.getElementById('audioImg').addEventListener('click', unlockAudioOnce, { once:true });

    // fixed mapping
    const fixedPairs = [
      { word: 'Kaartespill', image: 'https://i.postimg.cc/VSxkQyb8/temp-Image2t-Ew-Ew.avif', audio: 'https://github.com/albrechtclaire1007/p1spillsaachen/raw/main/1kaarte.mp3' },
      { word: 'Popp',        image: 'https://i.postimg.cc/7CFZ8vTw/temp-Imagee-DSUs6.avif',    audio: 'https://github.com/albrechtclaire1007/p1spillsaachen/raw/main/1popp.mp3' },
      { word: 'Péssel',      image: 'https://i.postimg.cc/XB3NqwL4/temp-Image-Jgec-Ta.avif',   audio: 'https://github.com/albrechtclaire1007/p1spillsaachen/raw/main/1pesel.mp3' },
      { word: 'Trommel',     image: 'https://i.postimg.cc/p9wLbNnb/temp-Image-MIU98-V.avif',   audio: 'https://github.com/albrechtclaire1007/p1spillsaachen/raw/main/1trommel.mp3' },
      { word: 'Fliger',      image: 'https://i.postimg.cc/DW9wkVb3/temp-Image-NAjh-GW.avif',   audio: 'https://github.com/albrechtclaire1007/p1spillsaachen/raw/main/1fliger.mp3' },
      { word: 'Teddybier',   image: 'https://i.postimg.cc/dkGtJW8B/temp-Imagep2-X0pu.avif',    audio: 'https://github.com/albrechtclaire1007/p1spillsaachen/raw/main/teddybier1.mp3' },
      { word: 'Videospill',  image: 'https://i.postimg.cc/tZFC9rhF/temp-Image-PC26-QV.avif',   audio: 'https://github.com/albrechtclaire1007/p1spillsaachen/raw/main/1video.mp3' },
      { word: 'Ball',        image: 'https://i.postimg.cc/G8vhbMkx/temp-Image-SMSSD4.avif',    audio: 'https://github.com/albrechtclaire1007/p1spillsaachen/raw/main/1ball.mp3' },
      { word: 'Vëlo',        image: 'https://i.postimg.cc/Q9cxj6pq/temp-Imagev-ZAm8p.avif',    audio: 'https://github.com/albrechtclaire1007/p1spillsaachen/raw/main/1velo.mp3' },
      { word: 'Radio',       image: 'https://i.postimg.cc/xNYj8K5f/temp-Image-W250-J5.avif',   audio: 'https://github.com/albrechtclaire1007/p1spillsaachen/raw/main/1radio.mp3' },
      { word: 'Roboter',     image: 'https://i.postimg.cc/vxM8TWhR/temp-Image-Xr-Gmf-G.avif',  audio: 'https://github.com/albrechtclaire1007/p1spillsaachen/raw/main/1roboter.mp3' },
      { word: 'Wierfel',     image: 'https://i.postimg.cc/vxM8TWhy/temp-Image-Zp-G0-TR.avif',  audio: 'https://github.com/albrechtclaire1007/p1spillsaachen/raw/main/1wierfel.mp3' }
    ];

    const words = [...fixedPairs].sort(() => Math.random() - 0.5);
    let currentWordIndex = 0;
    let currentAnswer = [];

    function shuffleArray(arr){
      const s=[...arr];
      for(let i=s.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [s[i],s[j]]=[s[j],s[i]];
      }
      return s;
    }

    function initializeWord(){
      const current = words[currentWordIndex];
      document.getElementById('wordCounter').textContent = `Wuert ${currentWordIndex + 1} vun ${words.length}`;
      document.getElementById('progressFill').style.width = ((currentWordIndex) / words.length) * 100 + '%';
      document.getElementById('toyImage').src = current.image;
      document.getElementById('toyImage').alt = current.word;
      audioEl.src = current.audio;

      currentAnswer = [];
      document.getElementById('feedback').textContent = '';
      document.getElementById('nextButton').style.display = 'none';
      document.getElementById('checkButton').disabled = false;

      const answerSlots = document.getElementById('answerSlots');
      answerSlots.innerHTML = '';
      for (let i = 0; i < current.word.length; i++){
        const slot = document.createElement('div');
        slot.className = 'slot';
        slot.dataset.index = i;
        slot.addEventListener('click', ()=> removeLetter(i));
        slot.addEventListener('dragover', (e)=>{ e.preventDefault(); slot.classList.add('drag-over'); });
        slot.addEventListener('dragleave', ()=> slot.classList.remove('drag-over'));
        slot.addEventListener('drop', (e)=>{
          e.preventDefault();
          slot.classList.remove('drag-over');
          const letter = e.dataTransfer.getData('text/plain');
          const tileUid = e.dataTransfer.getData('tile-uid');
          placeLetterInSlot(letter, i, tileUid);
        });
        answerSlots.appendChild(slot);
      }

      const shuffled = shuffleArray([...current.word]);
      const letterBank = document.getElementById('letterBank');
      letterBank.innerHTML = '';
      shuffled.forEach((letter, idx)=>{
        const tile = document.createElement('div');
        tile.className = 'letter-tile';
        tile.textContent = letter;
        tile.draggable = true;
        tile.dataset.uid = `${currentWordIndex}-${idx}-${Math.random().toString(36).slice(2,7)}`;
        tile.addEventListener('click', ()=> placeLetter(tile, letter));
        tile.addEventListener('dragstart', (e)=>{
          if (tile.classList.contains('used')) { e.preventDefault(); return; }
          e.dataTransfer.setData('text/plain', letter);
          e.dataTransfer.setData('tile-uid', tile.dataset.uid);
          e.dataTransfer.effectAllowed = 'move';
        });
        letterBank.appendChild(tile);
      });

      currentAnswer = new Array(current.word.length).fill('');
    }

    function findTileByUid(uid){
      return Array.from(document.querySelectorAll('.letter-tile')).find(t => t.dataset.uid === uid);
    }

    function placeLetter(tile, letter){
      if (tile.classList.contains('used')) return;
      const slots = document.querySelectorAll('.slot');
      for (let i = 0; i < slots.length; i++){
        if (currentAnswer[i] === ''){
          currentAnswer[i] = letter;
          slots[i].textContent = letter;
          slots[i].classList.add('filled');
          slots[i].dataset.tileUid = tile.dataset.uid;
          tile.classList.add('used');
          break;
        }
      }
    }

    function placeLetterInSlot(letter, slotIndex, tileUid){
      const slots = document.querySelectorAll('.slot');
      if (currentAnswer[slotIndex] !== '') removeLetter(slotIndex);
      currentAnswer[slotIndex] = letter;
      slots[slotIndex].textContent = letter;
      slots[slotIndex].classList.add('filled');
      slots[slotIndex].dataset.tileUid = tileUid;
      const tile = findTileByUid(tileUid);
      if (tile) tile.classList.add('used');
    }

    function removeLetter(slotIndex){
      if (currentAnswer[slotIndex] === '') return;
      const slots = document.querySelectorAll('.slot');
      const tileUid = slots[slotIndex].dataset.tileUid;
      const tile = tileUid ? findTileByUid(tileUid) : null;
      if (tile) tile.classList.remove('used');
      currentAnswer[slotIndex] = '';
      slots[slotIndex].textContent = '';
      slots[slotIndex].classList.remove('filled','correct','incorrect');
      delete slots[slotIndex].dataset.tileUid;
    }

    function resetWord(){
      const slots = document.querySelectorAll('.slot');
      const tiles = document.querySelectorAll('.letter-tile');
      slots.forEach(s => { s.textContent=''; s.className='slot'; delete s.dataset.tileUid; });
      tiles.forEach(t => t.classList.remove('used'));
      currentAnswer = new Array(words[currentWordIndex].word.length).fill('');
      document.getElementById('feedback').textContent = '';
      document.getElementById('nextButton').style.display = 'none';
      document.getElementById('checkButton').disabled = false;
    }

    function checkAnswer(){
      const target = words[currentWordIndex].word;
      const answer = currentAnswer.join('');
      const slots = document.querySelectorAll('.slot');
      const feedback = document.getElementById('feedback');
      if (answer === target){
        slots.forEach(s => s.classList.add('correct'));
        feedback.textContent = 'Super!';
        feedback.className = 'feedback success';
        document.getElementById('checkButton').disabled = true;
        document.getElementById('nextButton').style.display = 'inline-block';
      } else {
        for (let i = 0; i < target.length; i++){
          if (currentAnswer[i] !== target[i]){
            const tileUid = slots[i].dataset.tileUid;
            const tile = tileUid ? findTileByUid(tileUid) : null;
            if (tile) tile.classList.remove('used');
            slots[i].classList.add('incorrect');
            currentAnswer[i] = '';
            slots[i].textContent = '';
            setTimeout(()=>{ slots[i].classList.remove('incorrect','filled'); }, 450);
          } else {
            slots[i].classList.add('correct');
          }
        }
     

